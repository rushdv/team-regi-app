<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Team & Unassigned Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bgmain: "#020617",
            card: "#020817",
            accent: {
              500: "#22c55e",
              400: "#4ade80",
            },
          },
        },
      },
    };
  </script>
</head>

<body class="min-h-screen bg-bgmain text-slate-100 antialiased">
  <div id="root" class="flex items-center justify-center min-h-screen px-4 py-8"></div>

  <!-- React + ReactDOM + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- React App -->
  <script type="text/babel">
    const { useState } = React;

    //  Your deployed Apps Script Web App URL
    const API_URL =
      "https://script.google.com/macros/s/AKfycbxlIGmUliXhKvJq46fV_Q3WqBzAUIvXBl5Tw5Gwlnj_mIl0UBrtwtIxLOFgOxlNeFgx/exec";

    const COUNTRIES = [
      "Indonesia",
      "South Korea",
      "Pakistan",
      "China",
      "Vietnam",
      "Australia",
      "Japan",
      "Argentina",
      "Morocco",
    ];

    const MEMBER_LABELS = ["1st member", "2nd member", "3rd member", "4th member"];

    function App() {
      // team registration states
      const [teamName, setTeamName] = useState("");
      const [country, setCountry] = useState("");
      const [members, setMembers] = useState(["", "", "", ""]);
      const [submitting, setSubmitting] = useState(false);
      const [statusType, setStatusType] = useState("idle");
      const [statusMessage, setStatusMessage] = useState(
        "Select a country and register your team. Each country belongs to exactly one team."
      );
      const isLocked = statusType === "success";

      // unassigned states
      const [unName, setUnName] = useState("");
      const [unSubmitting, setUnSubmitting] = useState(false);
      const [unStatusType, setUnStatusType] = useState("idle");
      const [unStatusMessage, setUnStatusMessage] = useState(
        "If you don‚Äôt have a team yet, join the unassigned list."
      );

      const handleMemberChange = (index, value) => {
        const next = [...members];
        next[index] = value;
        setMembers(next);
      };

      //  Team registration submit
      const handleSubmit = async (e) => {
        e.preventDefault();

        if (!teamName.trim() || !country.trim()) {
          setStatusType("error");
          setStatusMessage("Please fill in team name and select a country.");
          return;
        }

        setSubmitting(true);
        setStatusType("info");
        setStatusMessage("Submitting your registration...");

        try {
          const payload = {
            mode: "team", //  identify in Apps Script
            country,
            teamName,
            members,
          };

          const res = await fetch(
            API_URL + "?data=" + encodeURIComponent(JSON.stringify(payload))
          );


          const data = await res.json().catch(() => ({}));

          if (!res.ok) {
            throw new Error(data.message || "Network error");
          }

          if (data.status === "taken") {
            setStatusType("taken");
            setStatusMessage(
              `Sorry, ${country} is already taken by another team. Please choose a different country.`
            );
          } else if (data.status === "ok") {
            setStatusType("success");
            setStatusMessage(
              `Team ‚Äú${teamName}‚Äù is successfully registered for ${country}.`
            );
          } else {
            setStatusType("error");
            setStatusMessage(
              data.message || "Unexpected response from server. Please try again."
            );
          }
        } catch (err) {
          console.error(err);
          setStatusType("error");
          setStatusMessage(
            "Something went wrong while registering. Please try again or contact the organizer."
          );
        } finally {
          setSubmitting(false);
        }
      };

      //  Unassigned registration submit
      const handleUnassignedSubmit = async (e) => {
        e.preventDefault();

        if (!unName.trim()) {
          setUnStatusType("error");
          setUnStatusMessage("Please enter your name.");
          return;
        }

        setUnSubmitting(true);
        setUnStatusType("info");
        setUnStatusMessage("Adding you to the unassigned list...");

        try {
          const payload = {
            mode: "unassigned", //  identify in Apps Script
            name: unName.trim(),
          };

          const res = await fetch(
  API_URL + "?data=" + encodeURIComponent(JSON.stringify(payload))
);


          const data = await res.json().catch(() => ({}));

          if (!res.ok) {
            throw new Error(data.message || "Network error");
          }

          if (data.status === "ok") {
            setUnStatusType("success");
            setUnStatusMessage(
              `You have been added to the unassigned list. Organizer can team you up later.`
            );
            setUnName("");
          } else {
            setUnStatusType("error");
            setUnStatusMessage(
              data.message ||
              "Something went wrong while adding you to the unassigned list."
            );
          }
        } catch (err) {
          console.error(err);
          setUnStatusType("error");
          setUnStatusMessage(
            "Something went wrong. Please try again or contact the organizer."
          );
        } finally {
          setUnSubmitting(false);
        }
      };

      const announcementStyles = {
        idle: "border-slate-700/60 bg-slate-900/60",
        info: "border-slate-600/80 bg-slate-900/70",
        success:
          "border-emerald-500/70 bg-emerald-900/30 text-emerald-100 shadow-lg shadow-emerald-500/20",
        taken:
          "border-amber-500/70 bg-amber-900/30 text-amber-100 shadow-lg shadow-amber-500/20",
        error:
          "border-red-500/70 bg-red-900/30 text-red-100 shadow-lg shadow-red-500/20",
      };

      const announcementIcon = {
        idle: "üí¨",
        info: "‚è≥",
        success: "‚úÖ",
        taken: "‚ö†Ô∏è",
        error: "‚ùå",
      };

      const currentAnnounceClass =
        announcementStyles[statusType] || announcementStyles.idle;
      const currentUnAnnounceClass =
        announcementStyles[unStatusType] || announcementStyles.idle;

      return (
        <div className="w-full max-w-4xl">
          <div className="relative overflow-hidden rounded-3xl bg-gradient-to-br from-slate-900/90 via-slate-950 to-slate-950 border border-slate-800/80 shadow-xl shadow-black/60">
            {/* subtle glow bg */}
            <div className="pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(45,212,191,0.04),_transparent_55%),radial-gradient(circle_at_bottom,_rgba(56,189,248,0.05),_transparent_60%)]" />

            <div className="relative px-6 py-6 sm:px-10 sm:py-10 space-y-10">
              {/* HEADER */}
              <header className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                  <h1 className="text-2xl sm:text-3xl font-semibold tracking-tight">
                    Team Registration Portal
                  </h1>
                  {/*
                  <p className="mt-1 text-sm text-slate-400 max-w-lg">
                    One country per team. Once a country is taken, no other team can select
                    it. Unassigned players can also register separately.
                  </p> 
                  */}
                </div>
                <div className="flex items-center gap-2 text-xs sm:text-sm text-slate-400">
                  <span className="inline-flex h-2 w-2 rounded-full bg-emerald-400 animate-pulse"></span>
                  <span>Connected to Google Sheets</span>
                </div>
              </header>

              {/* MAIN CONTENT: 2 sections in grid for larger screens */}
              <div className="grid grid-cols-1 lg:grid-cols-[minmax(0,2fr)_minmax(0,1.2fr)] gap-8">
                {/* LEFT: Team Registration */}
                <div className="space-y-6">
                  <h2 className="text-lg font-medium text-slate-100">
                    Register Your Team
                  </h2>
                  <form onSubmit={handleSubmit} className="space-y-6">
                    {/* Team Name */}
                    <div className="space-y-2">
                      <label className="block text-sm font-medium text-slate-200">
                        Team Name <span className="text-emerald-400">*</span>
                      </label>
                      <input
                        type="text"
                        value={teamName}
                        onChange={(e) => setTeamName(e.target.value)}
                        disabled={submitting || isLocked}
                        placeholder="Enter your team name"
                        className="w-full rounded-2xl bg-slate-900/70 border border-slate-700/80 px-4 py-2.5 text-sm sm:text-base placeholder:text-slate-500 outline-none transition-all duration-200 transform focus:border-accent-400 focus:ring-2 focus:ring-accent-500/70 focus:ring-offset-2 focus:ring-offset-bgmain focus:scale-[1.01] shadow-sm shadow-slate-900/50 focus:shadow-xl focus:shadow-emerald-500/20 disabled:opacity-50"
                      />
                    </div>

                    {/* Country */}
                    <div className="space-y-2">
                      <label className="block text-sm font-medium text-slate-200">
                        Select Country <span className="text-emerald-400">*</span>
                      </label>
                      <div className="relative">
                        <select
                          value={country}
                          onChange={(e) => setCountry(e.target.value)}
                          disabled={submitting || isLocked}
                          className="w-full appearance-none rounded-2xl bg-slate-900/70 border border-slate-700/80 px-4 py-2.5 text-sm sm:text-base text-slate-100 outline-none transition-all duration-200 transform focus:border-accent-400 focus:ring-2 focus:ring-accent-500/70 focus:ring-offset-2 focus:ring-offset-bgmain focus:scale-[1.01] shadow-sm shadow-slate-900/50 focus:shadow-xl focus:shadow-emerald-500/20 disabled:opacity-50"
                        >
                          <option value="">Choose a country</option>
                          {COUNTRIES.map((c) => (
                            <option key={c} value={c}>
                              {c}
                            </option>
                          ))}
                        </select>
                        <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4 text-slate-500">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            className="h-4 w-4"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              fillRule="evenodd"
                              d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
                              clipRule="evenodd"
                            />
                          </svg>
                        </div>
                      </div>
                    </div>

                    {/* Members */}
                    <div className="space-y-3">
                      <p className="text-sm font-medium text-slate-200">
                        Team Members
                        <span className="ml-2 text-xs font-normal text-slate-400">
                          (minimum 1 member)
                        </span>
                      </p>
                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        {MEMBER_LABELS.map((label, idx) => (
                          <div key={idx} className="space-y-1.5">
                            <span className="block text-xs text-slate-400">
                              {label}
                            </span>
                            <input
                              type="text"
                              value={members[idx]}
                              onChange={(e) => handleMemberChange(idx, e.target.value)}
                              disabled={submitting || isLocked}
                              placeholder="Full name"
                              className="w-full rounded-2xl bg-slate-900/70 border border-slate-700/80 px-3.5 py-2 text-sm placeholder:text-slate-500 outline-none transition-all duration-200 transform focus:border-accent-400 focus:ring-2 focus:ring-accent-500/70 focus:ring-offset-[1px] focus:ring-offset-bgmain focus:scale-[1.02] shadow-sm shadow-slate-900/40 focus:shadow-lg focus:shadow-emerald-500/15 disabled:opacity-50"
                            />
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* Submit button */}
                    <div className="pt-2">
                      <button
                        type="submit"
                        disabled={submitting || isLocked}
                        className="relative inline-flex items-center justify-center w-full sm:w-auto px-6 py-2.5 sm:px-8 sm:py-3 text-sm sm:text-base font-medium rounded-2xl overflow-hidden border border-emerald-500/70 bg-gradient-to-r from-emerald-500 via-emerald-400 to-emerald-500 text-slate-950 shadow-lg shadow-emerald-500/30 transition-all duration-200 transform hover:-translate-y-[1px] hover:shadow-xl hover:shadow-emerald-400/40 focus:outline-none focus:ring-2 focus:ring-emerald-400/80 focus:ring-offset-2 focus:ring-offset-bgmain disabled:opacity-60 disabled:cursor-not-allowed"
                      >
                        <span className="absolute inset-0 bg-gradient-to-r from-white/10 via-transparent to-white/10 opacity-0 hover:opacity-100 transition-opacity duration-300" />
                        <span className="relative flex items-center gap-2">
                          {submitting ? (
                            <>
                              <span className="h-4 w-4 border-2 border-slate-950/40 border-t-slate-950 rounded-full animate-spin"></span>
                              <span>Submitting...</span>
                            </>
                          ) : isLocked ? (
                            <>
                              <span>Registered</span>
                              <span className="text-xs text-slate-900/80">(locked)</span>
                            </>
                          ) : (
                            <span>Register Team</span>
                          )}
                        </span>
                      </button>
                    </div>
                  </form>

                  {/* Announcement / status */}
                  <section
                    className={
                      "mt-4 rounded-2xl border px-4 py-3 sm:px-5 sm:py-4 text-sm flex items-start gap-3 transition-all duration-300 " +
                      currentAnnounceClass
                    }
                  >
                    <div className="mt-[1px] text-lg">
                      {announcementIcon[statusType] || announcementIcon.idle}
                    </div>
                    <div className="space-y-1">
                      <p className="font-medium">
                        {statusType === "success"
                          ? "Registration successful"
                          : statusType === "taken"
                            ? "Country already taken"
                            : statusType === "error"
                              ? "Registration failed"
                              : statusType === "info"
                                ? "Processing..."
                                : "Announcement"}
                      </p>
                      <p className="text-slate-200/90 text-xs sm:text-sm">
                        {statusMessage}
                      </p>
                    </div>
                  </section>
                </div>

                {/* RIGHT: Unassigned section */}
                <div className="space-y-4 lg:border-l lg:border-slate-800/70 lg:pl-6">
                  <h2 className="text-lg font-medium text-slate-100">
                    Don‚Äôt have a team yet?
                  </h2>
                  {/*
                  <p className="text-xs sm:text-sm text-slate-400">
                    Add your name to the unassigned list. Organizers can later use this
                    list to form teams.
                  </p>
                  */}
                  <form onSubmit={handleUnassignedSubmit} className="space-y-4">
                    <div className="space-y-2">
                      <label className="block text-sm font-medium text-slate-200">
                        Your Name
                      </label>
                      <input
                        type="text"
                        value={unName}
                        onChange={(e) => setUnName(e.target.value)}
                        disabled={unSubmitting}
                        placeholder="Enter your full name"
                        className="w-full rounded-2xl bg-slate-900/70 border border-slate-700/80 px-4 py-2.5 text-sm placeholder:text-slate-500 outline-none transition-all duration-200 transform focus:border-accent-400 focus:ring-2 focus:ring-accent-500/70 focus:ring-offset-2 focus:ring-offset-bgmain focus:scale-[1.01] shadow-sm shadow-slate-900/50 focus:shadow-xl focus:shadow-emerald-500/20 disabled:opacity-50"
                      />
                    </div>

                    <button
                      type="submit"
                      disabled={unSubmitting}
                      className="relative inline-flex items-center justify-center w-full px-5 py-2.5 text-sm font-medium rounded-2xl overflow-hidden border border-slate-600/80 bg-slate-900/80 text-slate-100 shadow-md shadow-black/40 transition-all duration-200 transform hover:-translate-y-[1px] hover:shadow-lg hover:shadow-slate-800/80 focus:outline-none focus:ring-2 focus:ring-slate-500/80 focus:ring-offset-2 focus:ring-offset-bgmain disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      <span className="absolute inset-0 bg-gradient-to-r from-slate-100/5 via-transparent to-slate-100/5 opacity-0 hover:opacity-100 transition-opacity duration-300" />
                      <span className="relative flex items-center gap-2">
                        {unSubmitting ? (
                          <>
                            <span className="h-4 w-4 border-2 border-slate-300/40 border-t-slate-300 rounded-full animate-spin"></span>
                            <span>Adding...</span>
                          </>
                        ) : (
                          <span>Join Unassigned List</span>
                        )}
                      </span>
                    </button>
                  </form>

                  {/* Unassigned announcement */}
                  <section
                    className={
                      "mt-2 rounded-2xl border px-4 py-3 text-xs sm:text-sm flex items-start gap-3 transition-all duration-300 " +
                      currentUnAnnounceClass
                    }
                  >
                    <div className="mt-[1px] text-lg">
                      {announcementIcon[unStatusType] || announcementIcon.idle}
                    </div>
                    <div className="space-y-1">
                      <p className="font-medium">
                        {unStatusType === "success"
                          ? "Added to unassigned list"
                          : unStatusType === "error"
                            ? "Failed to add"
                            : unStatusType === "info"
                              ? "Processing..."
                              : "Unassigned info"}
                      </p>
                      <p className="text-slate-200/90">{unStatusMessage}</p>
                    </div>
                  </section>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>

</html>